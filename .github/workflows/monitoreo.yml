name: Monitoreo Autom√°tico y Manual

on:
  schedule:
    - cron: "*/10 * * * *"   # Ejecuta cada 10 minutos
  workflow_dispatch:          # Permite ejecuci√≥n manual desde GitHub

permissions:
  contents: write
  pull-requests: write

jobs:
  ejecutar-monitoreo:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Clonar repositorio
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: üß∞ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: ‚öôÔ∏è Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt || true

      - name: üöÄ Ejecutar script de monitoreo
        run: |
          python scripts/monitoreo.py

      - name: üóÇÔ∏è Crear Pull Request autom√°tico
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: "auto/monitoreo"
          title: "Actualizaci√≥n autom√°tica de monitoreo"
          body: "Este PR fue generado autom√°ticamente por el flujo de monitoreo."
          commit-message: "Actualizaci√≥n de datos autom√°ticos"
          labels: "autom√°tico, monitoreo"
          delete-branch: true
